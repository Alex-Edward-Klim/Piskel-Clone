!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);const n=document.querySelector(".tools__pen"),r=document.querySelector(".tools__paint-bucket"),a=document.querySelector(".tools__paint-all-pixels-of-the-same-color"),i=document.querySelector(".tools__eraser"),s=document.querySelector(".tools__stroke"),c=document.querySelector(".tools__color-picker"),l=document.querySelector(".canvas-1"),f=l.getContext("2d"),u=document.querySelector(".tools__primary-color-input"),d=document.querySelector(".tools__secondary-color-input"),m=document.querySelector(".tools__primary-color-button"),v=document.querySelector(".tools__secondary-color-button"),p=document.querySelector(".tools__swap-colors-button"),_=document.querySelector(".tools__btn-1"),g=document.querySelector(".tools__btn-2"),y=document.querySelector(".tools__btn-3"),b=document.querySelector(".tools__btn-4"),S=document.querySelector(".frame"),h=document.querySelector(".frames"),C=document.querySelector(".canvas-wrapper"),L=document.querySelector(".frames__create-new-frame-button"),x=document.querySelector(".frames__delete-frame-button"),k=document.querySelector(".output__final-gif"),E=document.querySelector(".output__refresh-button"),q=document.querySelector(".output__download-button"),w=document.querySelector(".output__fps-input"),$=document.querySelector(".output__fps-figure");l.number=1,u.value="#000000",d.value="#ffffff",m.addEventListener("click",()=>u.click()),v.addEventListener("click",()=>d.click()),u.addEventListener("change",e=>{Y.primaryColor=e.target.value,m.style.background=e.target.value}),d.addEventListener("change",e=>{Y.secondaryColor=e.target.value,v.style.background=e.target.value}),p.addEventListener("click",(function(){let e=u.value;u.value=d.value,Y.primaryColor=u.value,m.style.background=u.value,d.value=e,Y.secondaryColor=e,v.style.background=e,e=void 0}));const Y={tool:"pen",isDrawing:!1,matrixCoefficient:16,xStart:void 0,yStart:void 0,primaryColor:"#000000",secondaryColor:"#ffffff",activeCanvas:l,activeCanvasContext:f,activeFrameNumber:1,fpsRate:500,pixelSize:1,drawBresenhamLine(e,t,o,n,r,a){const i=a;function s(t,o){e.fillRect(t,o,i*Y.pixelSize,i*Y.pixelSize)}((e,t,o,n)=>{let r=e,a=t;const c=o,l=n;if(r===c&&a===l)return void s(r,a);const f=c-r,u=f<0?-1:1,d=l-a,m=d<0?-1:1;if(Math.abs(d)<Math.abs(f)){const e=d/f,t=a-e*r;for(;r!==c;)s(r,parseInt(Math.round(e*r+t),10)),r+=u*i}else{const e=f/d,t=r-e*a;for(;a!==l;)s(parseInt(Math.round(e*a+t),10),a),a+=m*i}s(c,l)})(t,o,n,r)},clearBresenhamLine(e,t,o,n,r,a){const i=a;function s(t,o){t/Y.matrixCoefficient%2==o/Y.matrixCoefficient%2?e.fillStyle="rgb(76, 76, 76)":e.fillStyle="rgb(85, 85, 85)",e.fillRect(t,o,i,i)}((e,t,o,n)=>{let r=e,a=t;const c=o,l=n;if(r===c&&a===l)return void s(r,a);const f=c-r,u=f<0?-1:1,d=l-a,m=d<0?-1:1;if(Math.abs(d)<Math.abs(f)){const e=d/f,t=a-e*r;for(;r!==c;)s(r,parseInt(Math.round(e*r+t),10)),r+=u*i}else{const e=f/d,t=r-e*a;for(;a!==l;)s(parseInt(Math.round(e*a+t),10),a),a+=m*i}s(c,l)})(t,o,n,r)},fillBucket(e,t,o,n){0===e.button?n.fillStyle=Y.primaryColor:n.fillStyle=Y.secondaryColor;const r=t,a=n.getImageData(e.offsetX,e.offsetY,1,1),i=JSON.stringify(Array.from(a.data)),s=n.getImageData(0,0,o.width,o.height).data;function c(e,t){if(e>=0&&e<o.width&&t>=0&&t<o.height){const n=4*(t*o.width+e),r=n+1,a=r+1,i=a+1;return[s[n],s[r],s[a],s[i]]}return!1}const l=[],f={};function u(e,t){const o=c(e,t-r),a=c(e-r,t),s=c(e+r,t),u=c(e,t+r);if(o&&JSON.stringify(o)===i){const o=`[${e},${t-r}]`;f[o]||(l.push(o),f[o]=!0)}if(a&&JSON.stringify(a)===i){const o=`[${e-r},${t}]`;f[o]||(l.push(o),f[o]=!0)}if(s&&JSON.stringify(s)===i){const o=`[${e+r},${t}]`;f[o]||(l.push(o),f[o]=!0)}if(u&&JSON.stringify(u)===i){const o=`[${e},${t+r}]`;f[o]||(l.push(o),f[o]=!0)}n.fillRect(e,t,r,r)}!function(e,t){for(l.push(JSON.stringify([e,t]));l.length;){const e=JSON.parse(l.pop());u(e[0],e[1])}}(e.offsetX-e.offsetX%r,e.offsetY-e.offsetY%r)},rgba2hex(e){const t=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return t&&4===t.length?`#${`0${parseInt(t[1],10).toString(16)}`.slice(-2)}${`0${parseInt(t[2],10).toString(16)}`.slice(-2)}${`0${parseInt(t[3],10).toString(16)}`.slice(-2)}`:""}};T(f),_.addEventListener("click",()=>{Y.pixelSize=1;const e=[_,g,y,b];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");_.classList.add("tools__active-pen-size-button")}),g.addEventListener("click",()=>{Y.pixelSize=2;const e=[_,g,y,b];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");g.classList.add("tools__active-pen-size-button")}),y.addEventListener("click",()=>{Y.pixelSize=3;const e=[_,g,y,b];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");y.classList.add("tools__active-pen-size-button")}),b.addEventListener("click",()=>{Y.pixelSize=4;const e=[_,g,y,b];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");b.classList.add("tools__active-pen-size-button")});const M=[n,r,a,i,s,c];function X(e){const t=e.getContext("2d");e.addEventListener("contextmenu",e=>e.preventDefault()),e.addEventListener("mousedown",e=>{if(Y.isDrawing=!0,"pen"===Y.tool&&(0===e.button?t.fillStyle=Y.primaryColor:t.fillStyle=Y.secondaryColor,Y.xStart=e.offsetX-e.offsetX%Y.matrixCoefficient,Y.yStart=e.offsetY-e.offsetY%Y.matrixCoefficient,Y.drawBresenhamLine(Y.activeCanvasContext,Y.xStart,Y.yStart,Y.xStart,Y.yStart,Y.matrixCoefficient)),"eraser"===Y.tool&&(Y.xStart=e.offsetX-e.offsetX%Y.matrixCoefficient,Y.yStart=e.offsetY-e.offsetY%Y.matrixCoefficient,Y.clearBresenhamLine(Y.activeCanvasContext,Y.xStart,Y.yStart,Y.xStart,Y.yStart,Y.matrixCoefficient)),"paintBucket"===Y.tool&&Y.fillBucket(e,Y.matrixCoefficient,Y.activeCanvas,Y.activeCanvasContext),"colorPicker"===Y.tool){const t=Y.activeCanvasContext.getImageData(e.offsetX,e.offsetY,1,1),o=Y.rgba2hex(`rgba(${t.data[0]}, ${t.data[1]}, ${t.data[2]}, ${t.data[3]/255})`);0===e.button?Y.primaryColor!==o&&(Y.primaryColor=o,m.style.background=Y.primaryColor,u.value=Y.primaryColor):Y.secondaryColor!==o&&(Y.secondaryColor=o,v.style.background=Y.secondaryColor,d.value=Y.secondaryColor)}}),e.addEventListener("mousemove",e=>{"pen"===Y.tool&&Y.isDrawing&&(Y.drawBresenhamLine(Y.activeCanvasContext,Y.xStart,Y.yStart,e.offsetX-e.offsetX%Y.matrixCoefficient,e.offsetY-e.offsetY%Y.matrixCoefficient,Y.matrixCoefficient),Y.xStart=e.offsetX-e.offsetX%Y.matrixCoefficient,Y.yStart=e.offsetY-e.offsetY%Y.matrixCoefficient),"eraser"===Y.tool&&Y.isDrawing&&(Y.clearBresenhamLine(Y.activeCanvasContext,Y.xStart,Y.yStart,e.offsetX-e.offsetX%Y.matrixCoefficient,e.offsetY-e.offsetY%Y.matrixCoefficient,Y.matrixCoefficient),Y.xStart=e.offsetX-e.offsetX%Y.matrixCoefficient,Y.yStart=e.offsetY-e.offsetY%Y.matrixCoefficient)}),e.addEventListener("mouseup",()=>{Y.isDrawing=!1,D()}),e.addEventListener("mouseout",()=>{Y.isDrawing=!1,D()})}n.addEventListener("click",()=>{Y.tool="pen";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");n.classList.add("tools__active-button")}),r.addEventListener("click",()=>{Y.tool="paintBucket";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");r.classList.add("tools__active-button")}),a.addEventListener("click",()=>{Y.tool="paintAllPixelsOfTheSameColor";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");a.classList.add("tools__active-button")}),i.addEventListener("click",()=>{Y.tool="eraser";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");i.classList.add("tools__active-button")}),s.addEventListener("click",()=>{Y.tool="stroke";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");s.classList.add("tools__active-button")}),c.addEventListener("click",()=>{Y.tool="colorPicker";for(let e=0;e<M.length;e+=1)M[e].classList.remove("tools__active-button");c.classList.add("tools__active-button")}),X(l);let z=[l],O=[f];function D(){let e=Y.activeCanvas.toDataURL("image/png");document.querySelector(".frames").children[N(Y.activeCanvas.number)].children[0].src=e}function R(){for(let e=0;e<z.length;e+=1)z[e].classList.add("hidden")}function B(e){Y.activeFrameNumber=e,Y.activeCanvas=document.querySelector(`.canvas-${e}`),Y.activeCanvasContext=Y.activeCanvas.getContext("2d"),R(),Y.activeCanvas.classList.remove("hidden");const t=document.querySelector(".frames");for(let e=0;e<t.children.length;e+=1)t.children[e].classList.remove("frames__active-frame");t.children[N(e)].classList.add("frames__active-frame")}function I(e){if(z.length>1){const t=N(e);Y.activeFrameNumber===e&&B(t>0?z[t-1].number:z[t+1].number);const o=function(e){const t=N(e),o=z.slice(0,t);o.push(...z.slice(t+1,z.length)),z=o;const n=O.slice(0,t);return n.push(...O.slice(t+1,O.length)),O=n,t}(e);C.removeChild(C.children[o]),h.removeChild(h.children[o])}}function N(e){for(let t=0;t<z.length;t+=1)if(z[t].number===e)return t}function P(){const e=new GIFEncoder;e.setRepeat(0),e.setDelay(Y.fpsRate),e.start();for(let t=0;t<O.length;t+=1)e.addFrame(O[t]);e.finish();const t=e.stream().getData(),o="data:image/gif;base64,"+encode64(t);return k.src=o,e}function T(e){const t=512/Y.matrixCoefficient,o=t/2;for(let n=0;n<=512;n+=t)for(let r=0;r<=512;r+=t)e.fillStyle="rgb(76, 76, 76)",e.fillRect(n,r,o,o),e.fillRect(n+o,r+o,o,o),e.fillStyle="rgb(85, 85, 85)",e.fillRect(n,r+o,o,o),e.fillRect(n+o,r,o,o)}S.number=1,S.addEventListener("click",e=>{B(e.target.number)}),D(),L.addEventListener("click",(function(){const e=z[z.length-1].number+1,t=document.createElement("div");t.classList.add("frames__single-frame-wrapper"),t.classList.add(`frames__frame-${e}`),t.innerHTML=`<img class="frame frame-${e}" src="" alt="" width=96 height=96><button class="frames__delete-frame-button"><img class="frames__delete-frame-image" src="./src/images/delete_frame.png" alt="delete frame button"></button>`,t.children[0].number=e,t.children[0].addEventListener("click",e=>{B(e.target.number)}),t.children[1].addEventListener("click",()=>{I(t.children[1].previousElementSibling.number)});const o=document.createElement("canvas");o.classList.add("canvas"),o.classList.add(`canvas-${e}`),o.innerHTML="Your browser doesn't support canvas!",o.setAttribute("height","512px"),o.setAttribute("width","512px"),o.number=e,Y.activeCanvas=o;const n=o.getContext("2d");T(n),Y.activeCanvasContext=n,X(o),R(),z.push(o),O.push(n),h.insertBefore(t,h.children[h.children.length-1]),C.appendChild(o),D(),B(e)})),x.addEventListener("click",()=>{I(x.previousElementSibling.number)}),E.addEventListener("click",()=>{k.src="./src/images/creating_gif_wait.png",setTimeout(()=>{P()},100)}),q.addEventListener("click",()=>{k.src="./src/images/creating_gif_wait.png",setTimeout(()=>{P().download("Sprite.gif")},100)}),w.addEventListener("input",()=>{Y.fpsRate=Math.round(1e3/w.value),$.innerHTML=`${w.value}`})}]);