!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);const n=document.querySelector(".tools__pen"),r=document.querySelector(".tools__paint-bucket"),a=document.querySelector(".tools__paint-all-pixels-of-the-same-color"),i=document.querySelector(".tools__eraser"),s=document.querySelector(".tools__stroke"),c=document.querySelector(".tools__color-picker"),l=document.querySelector(".canvas-1"),f=l.getContext("2d"),u=document.querySelector(".tools__primary-color-input"),d=document.querySelector(".tools__secondary-color-input"),m=document.querySelector(".tools__primary-color-button"),v=document.querySelector(".tools__secondary-color-button"),g=document.querySelector(".tools__swap-colors-button"),p=document.querySelector(".tools__btn-1"),y=document.querySelector(".tools__btn-2"),_=document.querySelector(".tools__btn-3"),S=document.querySelector(".tools__btn-4"),b=document.querySelector(".frame"),h=document.querySelector(".frames"),C=document.querySelector(".canvas-wrapper"),x=document.querySelector(".frames__create-new-frame-button"),L=document.querySelector(".frames__delete-frame-button"),k=document.querySelector(".output__final-gif"),E=document.querySelector(".output__refresh-button"),q=document.querySelector(".output__download-button"),w=document.querySelector(".output__fps-input"),O=document.querySelector(".output__fps-figure");l.number=1,u.value="#000000",d.value="#ffffff",m.addEventListener("click",()=>u.click()),v.addEventListener("click",()=>d.click()),u.addEventListener("change",e=>{$.primaryColor=e.target.value,m.style.background=e.target.value}),d.addEventListener("change",e=>{$.secondaryColor=e.target.value,v.style.background=e.target.value}),g.addEventListener("click",(function(){let e=u.value;u.value=d.value,$.primaryColor=u.value,m.style.background=u.value,d.value=e,$.secondaryColor=e,v.style.background=e,e=void 0}));const $={tool:"pen",isDrawing:!1,matrixCoefficient:16,xStart:void 0,yStart:void 0,primaryColor:"#000000",secondaryColor:"#ffffff",activeCanvas:l,activeCanvasContext:f,activeFrameNumber:1,fpsRate:500,pixelSize:1,drawBresenhamLine(e,t,o,n,r,a){const i=a;function s(t,o){e.fillRect(t,o,i*$.pixelSize,i*$.pixelSize)}((e,t,o,n)=>{let r=e,a=t;const c=o,l=n;if(r===c&&a===l)return void s(r,a);const f=c-r,u=f<0?-1:1,d=l-a,m=d<0?-1:1;if(Math.abs(d)<Math.abs(f)){const e=d/f,t=a-e*r;for(;r!==c;)s(r,parseInt(Math.round(e*r+t),10)),r+=u*i}else{const e=f/d,t=r-e*a;for(;a!==l;)s(parseInt(Math.round(e*a+t),10),a),a+=m*i}s(c,l)})(t,o,n,r)},clearBresenhamLine(e,t,o,n,r,a){const i=a;function s(t,o){t/$.matrixCoefficient%2==o/$.matrixCoefficient%2?e.fillStyle="rgb(76, 76, 76)":e.fillStyle="rgb(85, 85, 85)",e.fillRect(t,o,i,i)}((e,t,o,n)=>{let r=e,a=t;const c=o,l=n;if(r===c&&a===l)return void s(r,a);const f=c-r,u=f<0?-1:1,d=l-a,m=d<0?-1:1;if(Math.abs(d)<Math.abs(f)){const e=d/f,t=a-e*r;for(;r!==c;)s(r,parseInt(Math.round(e*r+t),10)),r+=u*i}else{const e=f/d,t=r-e*a;for(;a!==l;)s(parseInt(Math.round(e*a+t),10),a),a+=m*i}s(c,l)})(t,o,n,r)},fillBucket(e,t,o,n){0===e.button?n.fillStyle=$.primaryColor:n.fillStyle=$.secondaryColor;const r=t,a=n.getImageData(e.offsetX,e.offsetY,1,1),i=JSON.stringify(Array.from(a.data)),s=n.getImageData(0,0,o.width,o.height).data;function c(e,t){if(e>=0&&e<o.width&&t>=0&&t<o.height){const n=4*(t*o.width+e),r=n+1,a=r+1,i=a+1;return[s[n],s[r],s[a],s[i]]}return!1}const l=[],f={};function u(e,t){const o=c(e,t-r),a=c(e-r,t),s=c(e+r,t),u=c(e,t+r);if(o&&(JSON.stringify(o)===i||"[85,85,85,255]"===JSON.stringify(o)||"[76,76,76,255]"===JSON.stringify(o))){const o=`[${e},${t-r}]`;f[o]||(l.push(o),f[o]=!0)}if(a&&(JSON.stringify(a)===i||"[85,85,85,255]"===JSON.stringify(a)||"[76,76,76,255]"===JSON.stringify(a))){const o=`[${e-r},${t}]`;f[o]||(l.push(o),f[o]=!0)}if(s&&(JSON.stringify(s)===i||"[85,85,85,255]"===JSON.stringify(s)||"[76,76,76,255]"===JSON.stringify(s))){const o=`[${e+r},${t}]`;f[o]||(l.push(o),f[o]=!0)}if(u&&(JSON.stringify(u)===i||"[85,85,85,255]"===JSON.stringify(u)||"[76,76,76,255]"===JSON.stringify(u))){const o=`[${e},${t+r}]`;f[o]||(l.push(o),f[o]=!0)}n.fillRect(e,t,r,r)}!function(e,t){for(l.push(JSON.stringify([e,t]));l.length;){const e=JSON.parse(l.pop());u(e[0],e[1])}}(e.offsetX-e.offsetX%r,e.offsetY-e.offsetY%r)},paintAllPixelsOfTheSameColor(e,t,o,n){0===e.button?n.fillStyle=$.primaryColor:n.fillStyle=$.secondaryColor;const r=t,a=n.getImageData(e.offsetX,e.offsetY,1,1),i=Array.from(a.data),s=n.getImageData(0,0,o.width,o.height).data;for(let e=0;e<s.length;e+=512*r*4)for(let t=e;t<4*(e+512);t+=4*r)i[0]===s[t]&&i[1]===s[t+1]&&i[2]===s[t+2]&&i[3]===s[t+3]&&n.fillRect(t/4%512,Math.floor(t/4/512),r,r)},rgba2hex(e){const t=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return t&&4===t.length?`#${`0${parseInt(t[1],10).toString(16)}`.slice(-2)}${`0${parseInt(t[2],10).toString(16)}`.slice(-2)}${`0${parseInt(t[3],10).toString(16)}`.slice(-2)}`:""}};P(f),p.addEventListener("click",()=>{$.pixelSize=1;const e=[p,y,_,S];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");p.classList.add("tools__active-pen-size-button")}),y.addEventListener("click",()=>{$.pixelSize=2;const e=[p,y,_,S];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");y.classList.add("tools__active-pen-size-button")}),_.addEventListener("click",()=>{$.pixelSize=3;const e=[p,y,_,S];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");_.classList.add("tools__active-pen-size-button")}),S.addEventListener("click",()=>{$.pixelSize=4;const e=[p,y,_,S];for(let t=0;t<4;t+=1)e[t].classList.remove("tools__active-pen-size-button");S.classList.add("tools__active-pen-size-button")});const N=[n,r,a,i,s,c];function Y(e){const t=e.getContext("2d");e.addEventListener("contextmenu",e=>e.preventDefault()),e.addEventListener("mousedown",e=>{if($.isDrawing=!0,"pen"===$.tool&&(0===e.button?t.fillStyle=$.primaryColor:t.fillStyle=$.secondaryColor,$.xStart=e.offsetX-e.offsetX%$.matrixCoefficient,$.yStart=e.offsetY-e.offsetY%$.matrixCoefficient,$.drawBresenhamLine($.activeCanvasContext,$.xStart,$.yStart,$.xStart,$.yStart,$.matrixCoefficient)),"eraser"===$.tool&&($.xStart=e.offsetX-e.offsetX%$.matrixCoefficient,$.yStart=e.offsetY-e.offsetY%$.matrixCoefficient,$.clearBresenhamLine($.activeCanvasContext,$.xStart,$.yStart,$.xStart,$.yStart,$.matrixCoefficient)),"paintBucket"===$.tool&&$.fillBucket(e,$.matrixCoefficient,$.activeCanvas,$.activeCanvasContext),"colorPicker"===$.tool){const t=$.activeCanvasContext.getImageData(e.offsetX,e.offsetY,1,1),o=$.rgba2hex(`rgba(${t.data[0]}, ${t.data[1]}, ${t.data[2]}, ${t.data[3]/255})`);0===e.button?$.primaryColor!==o&&($.primaryColor=o,m.style.background=$.primaryColor,u.value=$.primaryColor):$.secondaryColor!==o&&($.secondaryColor=o,v.style.background=$.secondaryColor,d.value=$.secondaryColor)}"paintAllPixelsOfTheSameColor"===$.tool&&$.paintAllPixelsOfTheSameColor(e,$.matrixCoefficient,$.activeCanvas,$.activeCanvasContext)}),e.addEventListener("mousemove",e=>{"pen"===$.tool&&$.isDrawing&&($.drawBresenhamLine($.activeCanvasContext,$.xStart,$.yStart,e.offsetX-e.offsetX%$.matrixCoefficient,e.offsetY-e.offsetY%$.matrixCoefficient,$.matrixCoefficient),$.xStart=e.offsetX-e.offsetX%$.matrixCoefficient,$.yStart=e.offsetY-e.offsetY%$.matrixCoefficient),"eraser"===$.tool&&$.isDrawing&&($.clearBresenhamLine($.activeCanvasContext,$.xStart,$.yStart,e.offsetX-e.offsetX%$.matrixCoefficient,e.offsetY-e.offsetY%$.matrixCoefficient,$.matrixCoefficient),$.xStart=e.offsetX-e.offsetX%$.matrixCoefficient,$.yStart=e.offsetY-e.offsetY%$.matrixCoefficient)}),e.addEventListener("mouseup",()=>{$.isDrawing=!1,z()}),e.addEventListener("mouseout",()=>{$.isDrawing=!1,z()})}n.addEventListener("click",()=>{$.tool="pen";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");n.classList.add("tools__active-button")}),r.addEventListener("click",()=>{$.tool="paintBucket";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");r.classList.add("tools__active-button")}),a.addEventListener("click",()=>{$.tool="paintAllPixelsOfTheSameColor";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");a.classList.add("tools__active-button")}),i.addEventListener("click",()=>{$.tool="eraser";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");i.classList.add("tools__active-button")}),s.addEventListener("click",()=>{$.tool="stroke";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");s.classList.add("tools__active-button")}),c.addEventListener("click",()=>{$.tool="colorPicker";for(let e=0;e<N.length;e+=1)N[e].classList.remove("tools__active-button");c.classList.add("tools__active-button")}),Y(l);let M=[l],X=[f];function z(){let e=$.activeCanvas.toDataURL("image/png");document.querySelector(".frames").children[R($.activeCanvas.number)].children[0].src=e}function D(){for(let e=0;e<M.length;e+=1)M[e].classList.add("hidden")}function J(e){$.activeFrameNumber=e,$.activeCanvas=document.querySelector(`.canvas-${e}`),$.activeCanvasContext=$.activeCanvas.getContext("2d"),D(),$.activeCanvas.classList.remove("hidden");const t=document.querySelector(".frames");for(let e=0;e<t.children.length;e+=1)t.children[e].classList.remove("frames__active-frame");t.children[R(e)].classList.add("frames__active-frame")}function I(e){if(M.length>1){const t=R(e);$.activeFrameNumber===e&&J(t>0?M[t-1].number:M[t+1].number);const o=function(e){const t=R(e),o=M.slice(0,t);o.push(...M.slice(t+1,M.length)),M=o;const n=X.slice(0,t);return n.push(...X.slice(t+1,X.length)),X=n,t}(e);C.removeChild(C.children[o]),h.removeChild(h.children[o])}}function R(e){for(let t=0;t<M.length;t+=1)if(M[t].number===e)return t}function B(){const e=new GIFEncoder;e.setRepeat(0),e.setDelay($.fpsRate),e.start();for(let t=0;t<X.length;t+=1)e.addFrame(X[t]);e.finish();const t=e.stream().getData(),o="data:image/gif;base64,"+encode64(t);return k.src=o,e}function P(e){const t=512/$.matrixCoefficient,o=t/2;for(let n=0;n<=512;n+=t)for(let r=0;r<=512;r+=t)e.fillStyle="rgb(76, 76, 76)",e.fillRect(n,r,o,o),e.fillRect(n+o,r+o,o,o),e.fillStyle="rgb(85, 85, 85)",e.fillRect(n,r+o,o,o),e.fillRect(n+o,r,o,o)}b.number=1,b.addEventListener("click",e=>{J(e.target.number)}),z(),x.addEventListener("click",(function(){const e=M[M.length-1].number+1,t=document.createElement("div");t.classList.add("frames__single-frame-wrapper"),t.classList.add(`frames__frame-${e}`),t.innerHTML=`<img class="frame frame-${e}" src="" alt="" width=96 height=96><button class="frames__delete-frame-button"><img class="frames__delete-frame-image" src="./src/images/delete_frame.png" alt="delete frame button"></button>`,t.children[0].number=e,t.children[0].addEventListener("click",e=>{J(e.target.number)}),t.children[1].addEventListener("click",()=>{I(t.children[1].previousElementSibling.number)});const o=document.createElement("canvas");o.classList.add("canvas"),o.classList.add(`canvas-${e}`),o.innerHTML="Your browser doesn't support canvas!",o.setAttribute("height","512px"),o.setAttribute("width","512px"),o.number=e,$.activeCanvas=o;const n=o.getContext("2d");P(n),$.activeCanvasContext=n,Y(o),D(),M.push(o),X.push(n),h.insertBefore(t,h.children[h.children.length-1]),C.appendChild(o),z(),J(e)})),L.addEventListener("click",()=>{I(L.previousElementSibling.number)}),E.addEventListener("click",()=>{k.src="./src/images/creating_gif_wait.png",setTimeout(()=>{B()},100)}),q.addEventListener("click",()=>{k.src="./src/images/creating_gif_wait.png",setTimeout(()=>{B().download("Sprite.gif")},100)}),w.addEventListener("input",()=>{$.fpsRate=Math.round(1e3/w.value),O.innerHTML=`${w.value}`})}]);